<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.tailwindcss.com"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
        <script>
            const regexKKO = /KKO\s?(?<year>\d{4}):(?<caseNo>\d{1,3})/i;            

            document.addEventListener('alpine:init', () => {            
                Alpine.data('jump', () => ({
                    result: { title: "", links: [] },
                    error: undefined,
                    /*result: { title: "KKO 2018:22", links: [
                        {
                            title: "Finlex",
                            href: "https://finlex.fi"
                        }
                    ]},*/
         
                    search(e) {
                        var needle = e.target.value;
                    
                        var match = needle.match(regexKKO);                

                        this.error = undefined;

                        if (match !== null) {
                            this.result = this.getKKOResult(match.groups);
                        } else {
                            this.error = "Ei tuloksia";
                        }
                    },
                    go() {
                        if (this.result.links.length > 0) {
                            window.location = this.result.links[0].href;
                        }
                    },
                    getKKOResult({ year, caseNo }) {
                        return {
                            title: `KKO ${year}:${caseNo}`,
                            links: [
                                {
                                    title: "Finlex",
                                    href: `https://www.finlex.fi/fi/oikeus/kko/kko/${year}/${year}${this.leftpad(caseNo, 4, '0')}`
                                }
                            ]
                        }
                    },
                    leftpad(input, length, pad) {
                        const padLength = Math.max(0, length - input.length);

                        return `${[...Array(padLength).keys()].map(_ => pad).join("")}${input}`;
                    }
                }))
            })
        </script>
    </head>
    <body>
        <div 
            x-data="jump"             
            class="container mx-auto my-4 flex flex-col items-center gap-2">
            <input 
                type="text" 
                @keyup="search"
                @keyup.enter="go" 
                placeholder="KKO 2022:18" 
                class="block border-4 rounded-lg text-center text-xl"/>

            <span x-text="error"></span>

            <div class="flex flex-row">                
                <template x-for="link in result.links">                    
                    <a 
                        x-text="link.title" 
                        :href="link.href"
                        class="block border-2 p-4 rounded-lg text-center drop-shadow">
                    </a>                
                </template>
            </div>
        </div>
    </body>
</html>